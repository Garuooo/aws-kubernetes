git clone https://github.com/Garuooo/aws-kubernetes.git
sudo bash install.sh
terraform init
terraform apply --auto-approve
ansible-galaxy collection install cloud.terraform 
chmod 600 private-key.pem
ansible-playbook -i inventory.yml playbook.yml

# remove subnet at d,e,f
# node pool 3 t3.medium
# eks permission, ec2 admin
aws eks --region us-east-1 update-kubeconfig --name kafka-on-eks
kubectl create namespace kafka
kubectl create -f 'https://strimzi.io/install/latest?namespace=kafka' -n kafka
kubectl get pod -n kafka --watch
git clone https://github.com/Garuooo/aws-kubernetes.git
cd aws-kubernetes/kafka-on-eks
kubectl apply -f kafka.yaml -n kafka 
kubectl logs deployment/strimzi-cluster-operator -n kafka -f

kubectl apply -f kafkaui.yaml -n kafka 

docker login
cat ~/.docker/config.json
kubectl create secret generic dockerhub-secret \
    --from-file=.dockerconfigjson=$HOME/.docker/config.json \
    --type=kubernetes.io/dockerconfigjson -n kafka 


kubectl get secret dockerhub-secret -n kafka  --output=yaml
kubectl apply -f kafka-connect.yaml -n kafka 
kubectl apply -f mysql.yaml -n kafka 
kubectl get pod -n kafka --watch

kubectl apply -f connectors.yaml -n kafka 

##install helm
curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash

## install prometheus operator
kubectl create namespace monitoring
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update
helm install prometheus-operator prometheus-community/kube-prometheus-stack --namespace monitoring
kubectl get pods -n monitoring
kubectl apply -f grafana.yaml -n monitoring 
kubectl apply -f prometheus.yaml -n monitoring 

kubectl exec -it mysql-master-f744f8758-g9wxw -n kafka -- /bin/bash 
kubectl exec -it mysql-replica-8d8858b47-8rpnc -n kafka -- /bin/bash 

mysql -p
mysqlpw

USE mydatabase;



## tables excluded = customer_info
## columns excluded = mydatabase.subscriber_data.email,mydatabase.subscriber_data.credit_card
CREATE TABLE customer_info (           
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    credit_card VARCHAR(19) NOT NULL,
    first_name VARCHAR(100),
    last_name VARCHAR(100),
    phone_number VARCHAR(15)
);

CREATE TABLE subscriber_data (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    credit_card VARCHAR(19) NOT NULL,
    subscription_date DATE,
    renewal_date DATE,
    status VARCHAR(50)
);

CREATE TABLE client_records (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    credit_card VARCHAR(19) NOT NULL,
    address VARCHAR(255),
    city VARCHAR(100),
    country VARCHAR(100)
);


-- Initialize customer_info with an initial user
INSERT INTO customer_info (email, credit_card, first_name, last_name, phone_number) 
VALUES ('initial_user@example.com', '0000-0000-0000-0000', 'Initial', 'User', '000-000-0000');

-- Initialize subscriber_data with an initial user
INSERT INTO subscriber_data (email, credit_card, subscription_date, renewal_date, status) 
VALUES ('initial_user@example.com', '0000-0000-0000-0000', '2023-01-01', '2024-01-01', 'active');

-- Initialize client_records with an initial user
INSERT INTO client_records (email, credit_card, address, city, country) 
VALUES ('initial_user@example.com', '0000-0000-0000-0000', '123 Initial St', 'Initial City', 'Initial Country');



-- Insert data into customer_info
INSERT INTO customer_info (email, credit_card, first_name, last_name, phone_number) 
VALUES ('customer1@example.com', '1234-5678-9101-1121', 'John', 'Doe', '123-456-7890');
INSERT INTO customer_info (email, credit_card, first_name, last_name, phone_number) 
VALUES ('customer2@example.com', '2345-6789-1011-1213', 'Jane', 'Smith', '234-567-8901');

-- Insert data into subscriber_data
INSERT INTO subscriber_data (email, credit_card, subscription_date, renewal_date, status) 
VALUES ('subscriber1@example.com', '3456-7890-1121-3141', '2023-01-01', '2024-01-01', 'active');
INSERT INTO subscriber_data (email, credit_card, subscription_date, renewal_date, status) 
VALUES ('subscriber2@example.com', '4567-8901-1213-4151', '2023-02-01', '2024-02-01', 'inactive');

-- Insert data into client_records
INSERT INTO client_records (email, credit_card, address, city, country) 
VALUES ('client1@example.com', '5678-9012-1314-5161', '123 Main St', 'Anytown', 'USA');
INSERT INTO client_records (email, credit_card, address, city, country) 
VALUES ('client2@example.com', '6789-0123-1415-6171', '456 Elm St', 'Othertown', 'Canada');


-- Delete data from customer_info
DELETE FROM customer_info WHERE email = 'customer1@example.com';

-- Delete data from subscriber_data
DELETE FROM subscriber_data WHERE email = 'subscriber1@example.com';

-- Delete data from client_records
DELETE FROM client_records WHERE email = 'client1@example.com';

